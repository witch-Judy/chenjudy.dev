---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Hero from "@/components/Hero.astro";
import Projects from "@/components/Projects.astro";
import Contact from "@/components/Contact.astro";
import { en } from "@/i18n/en";
import { zh } from "@/i18n/zh";
---

<Layout scrollSmooth>
  <Header />
  <main id="main-content" data-layout="index" class="app-layout">
    <Hero />

    <section
      id="about-section"
      class="border-t border-border pt-12 pb-6"
    >
      <div class="flex flex-col items-center gap-8 sm:flex-row sm:items-start">
        <div class="shrink-0">
          <img
            src={`${import.meta.env.BASE_URL}/assets/self1.webp`}
            alt="Chen Judy"
            class="w-44 rounded-2xl object-cover shadow-md sm:w-52"
            loading="lazy"
          />
        </div>
        <div class="flex-1">
          <h2
            class="text-2xl font-semibold tracking-wide"
            data-lang-en={en.aboutTitle}
            data-lang-zh={zh.aboutTitle}
          >
            {en.aboutTitle}
          </h2>
          <p
            class="mt-4 leading-relaxed text-foreground/80"
            data-lang-en={en.aboutBio}
            data-lang-zh={zh.aboutBio}
          >
            {en.aboutBio}
          </p>
        </div>
      </div>
    </section>

    <div class="border-t border-border">
      <Projects />
    </div>

    <div class="border-t border-border">
      <Contact />
    </div>
  </main>
  <Footer />
</Layout>

<script>
  function initLang() {
    const lang = localStorage.getItem("lang") || "en";
    applyLang(lang);
  }

  function applyLang(lang: string) {
    document.querySelectorAll("[data-lang-en]").forEach(el => {
      const text = lang === "zh"
        ? el.getAttribute("data-lang-zh")
        : el.getAttribute("data-lang-en");
      if (text) el.textContent = text;
    });
  }

  // Listen for custom language change events
  window.addEventListener("lang-change", ((e: CustomEvent) => {
    applyLang(e.detail.lang);
  }) as EventListener);

  initLang();
  document.addEventListener("astro:after-swap", initLang);
</script>
